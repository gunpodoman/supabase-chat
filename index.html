<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Supabase ì‹¤ì‹œê°„ ì‹œìŠ¤í…œ</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Pretendard:wght@400;600;700&display=swap');
        body { font-family: 'Pretendard', sans-serif; transition: all 0.3s; }
        .auth-card { transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1); }
    </style>
</head>
<body id="bodyBg" class="bg-slate-100 flex items-center justify-center min-h-screen p-4">

    <div id="app" class="auth-card w-full max-w-md bg-white h-[750px] rounded-[2.5rem] shadow-2xl overflow-hidden flex flex-col">
        
        <div id="authView" class="p-10 flex-1 flex flex-col justify-center">
            <div class="text-center mb-8">
                <div id="authIcon" class="inline-block p-5 bg-emerald-50 text-emerald-500 rounded-3xl mb-4 text-3xl">ğŸ”“</div>
                <h1 id="authTitle" class="text-3xl font-bold text-gray-900 transition-all">ë¡œê·¸ì¸</h1>
                <p id="authSub" class="text-gray-500 mt-2 transition-all">ë“±ë¡ëœ ê³„ì •ìœ¼ë¡œ ì ‘ì†í•˜ì„¸ìš”.</p>
            </div>
            
            <div class="space-y-4">
                <div class="space-y-1">
                    <label class="text-xs font-semibold text-gray-400 ml-1">ì•„ì´ë””</label>
                    <input type="text" id="userId" placeholder="ì•„ì´ë””ë¥¼ ì…ë ¥í•˜ì„¸ìš”" class="w-full p-4 bg-gray-50 border border-gray-100 rounded-2xl outline-none focus:ring-2 focus:ring-emerald-500 transition-all">
                </div>
                <div class="space-y-1">
                    <label class="text-xs font-semibold text-gray-400 ml-1">ë¹„ë°€ë²ˆí˜¸</label>
                    <input type="password" id="userPw" placeholder="ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”" class="w-full p-4 bg-gray-50 border border-gray-100 rounded-2xl outline-none focus:ring-2 focus:ring-emerald-500 transition-all">
                </div>
                
                <div class="pt-4">
                    <button onclick="handleAuth()" id="mainBtn" class="w-full py-4 bg-emerald-500 text-white font-bold rounded-2xl shadow-lg shadow-emerald-100 active:scale-95 transition-all">ì ‘ì†í•˜ê¸°</button>
                    <button onclick="toggleAuth()" id="subBtn" class="w-full py-4 text-emerald-600 font-semibold mt-2 hover:bg-emerald-50 rounded-2xl transition-all">ê³„ì •ì´ ì—†ìœ¼ì‹ ê°€ìš”? íšŒì›ê°€ì…</button>
                </div>
            </div>
        </div>

        <div id="mainView" class="hidden flex flex-col h-full">
            <header class="p-6 border-b flex justify-between items-center bg-white">
                <h2 id="displayId" class="text-xl font-bold text-gray-800">User</h2>
                <button onclick="logout()" class="text-xs font-bold text-rose-500">ë¡œê·¸ì•„ì›ƒ</button>
            </header>
            <div id="chatBox" class="flex-1 p-5 overflow-y-auto space-y-4 bg-gray-50 flex flex-col"></div>
            <div class="p-4 bg-white border-t flex gap-2">
                <input type="text" id="chatInput" placeholder="ë©”ì‹œì§€ ì…ë ¥..." class="flex-1 p-3 bg-gray-100 rounded-2xl outline-none" onkeypress="if(event.keyCode==13) sendChat()">
                <button onclick="sendChat()" class="bg-emerald-500 text-white px-6 py-3 rounded-2xl font-bold">ì „ì†¡</button>
            </div>
        </div>
    </div>

    <script>
        // Supabase ì„¤ì • (ì£¼ì‹  ì •ë³´ ê·¸ëŒ€ë¡œ ì ìš©)
        const SB_URL = 'https://quqnmzarcrhwbdokfsgz.supabase.co'; 
        const SB_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InF1cW5temFyY3Jod2Jkb2tmc2d6Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjY1MTc3ODQsImV4cCI6MjA4MjA5Mzc4NH0.ZBjfXMX3bKk6vJRmsb49MkV3Lq-O5stujPWk_44-kdc';
        const supabase = supabase.createClient(SB_URL, SB_KEY);

        let isSignup = false;
        let currentUser = localStorage.getItem("sb_user");

        if(currentUser) showMain();

        // [í™”ë©´ ì „í™˜ í•¨ìˆ˜ - ì—¬ê¸°ê°€ ìˆ˜ì •ëœ í•µì‹¬ì…ë‹ˆë‹¤!]
        function toggleAuth() {
            isSignup = !isSignup;
            
            const title = document.getElementById('authTitle');
            const sub = document.getElementById('authSub');
            const btn = document.getElementById('mainBtn');
            const subBtn = document.getElementById('subBtn');
            const icon = document.getElementById('authIcon');
            const body = document.getElementById('bodyBg');

            if (isSignup) {
                // íšŒì›ê°€ì… ëª¨ë“œì¼ ë•Œ ë³€í™”
                title.innerText = "íšŒì›ê°€ì…";
                sub.innerText = "ìƒˆë¡œìš´ ê³„ì •ì„ ë§Œë“¤ê³  ì‹œì‘í•˜ì„¸ìš”.";
                btn.innerText = "ê°€ì… ì™„ë£Œ";
                btn.className = "w-full py-4 bg-blue-500 text-white font-bold rounded-2xl shadow-lg shadow-blue-100 active:scale-95 transition-all";
                subBtn.innerText = "ì´ë¯¸ ê³„ì •ì´ ìˆë‚˜ìš”? ë¡œê·¸ì¸";
                icon.innerText = "ğŸ“";
                icon.className = "inline-block p-5 bg-blue-50 text-blue-500 rounded-3xl mb-4 text-3xl";
                body.className = "bg-blue-50 flex items-center justify-center min-h-screen p-4";
            } else {
                // ë¡œê·¸ì¸ ëª¨ë“œì¼ ë•Œ ë³€í™”
                title.innerText = "ë¡œê·¸ì¸";
                sub.innerText = "ë“±ë¡ëœ ê³„ì •ìœ¼ë¡œ ì ‘ì†í•˜ì„¸ìš”.";
                btn.innerText = "ì ‘ì†í•˜ê¸°";
                btn.className = "w-full py-4 bg-emerald-500 text-white font-bold rounded-2xl shadow-lg shadow-emerald-100 active:scale-95 transition-all";
                subBtn.innerText = "ê³„ì •ì´ ì—†ìœ¼ì‹ ê°€ìš”? íšŒì›ê°€ì…";
                icon.innerText = "ğŸ”“";
                icon.className = "inline-block p-5 bg-emerald-50 text-emerald-500 rounded-3xl mb-4 text-3xl";
                body.className = "bg-slate-100 flex items-center justify-center min-h-screen p-4";
            }
        }

        // ì¸ì¦ ì²˜ë¦¬ (íšŒì›ê°€ì…/ë¡œê·¸ì¸ ì‹¤í–‰)
        async function handleAuth() {
            const id = document.getElementById('userId').value;
            const pw = document.getElementById('userPw').value;
            if(!id || !pw) return alert("ë¹ˆì¹¸ì„ ì±„ì›Œì£¼ì„¸ìš”.");

            if(isSignup) {
                const { data: exist } = await supabase.from('profiles').select('*').eq('username', id);
                if(exist && exist.length > 0) return alert("ì´ë¯¸ ìˆëŠ” ì•„ì´ë””ì…ë‹ˆë‹¤.");
                
                const { error } = await supabase.from('profiles').insert([{ username: id, password: pw }]);
                if(!error) {
                    alert("ê°€ì… ì„±ê³µ! ë¡œê·¸ì¸ í•´ì£¼ì„¸ìš”.");
                    toggleAuth(); // ê°€ì… ì„±ê³µ í›„ ìë™ìœ¼ë¡œ ë¡œê·¸ì¸ ëª¨ë“œë¡œ ì „í™˜
                } else {
                    alert("ê°€ì… ì‹¤íŒ¨: " + error.message);
                }
            } else {
                const { data } = await supabase.from('profiles').select('*').eq('username', id).eq('password', pw);
                if(data && data.length > 0) {
                    currentUser = id;
                    localStorage.setItem("sb_user", id);
                    showMain();
                } else {
                    alert("ì•„ì´ë””ë‚˜ ë¹„ë°€ë²ˆí˜¸ê°€ í‹€ë ¤ìš”.");
                }
            }
        }

        // ì´í•˜ ë©”ì¸ ì±„íŒ… ë¡œì§ (ìƒëµ - ì´ì „ê³¼ ë™ì¼í•˜ê²Œ ì‘ë™)
        function showMain() {
            document.getElementById('authView').classList.add('hidden');
            document.getElementById('mainView').classList.remove('hidden');
            document.getElementById('displayId').innerText = currentUser;
            loadHistory();
            supabase.channel('public:messages').on('postgres_changes', { event: 'INSERT', schema: 'public', table: 'messages' }, p => appendMsg(p.new)).subscribe();
        }

        async function loadHistory() {
            const { data } = await supabase.from('messages').select('*').order('created_at', { ascending: true });
            if(data) data.forEach(appendMsg);
        }

        async function sendChat() {
            const input = document.getElementById('chatInput');
            if(!input.value.trim()) return;
            await supabase.from('messages').insert([{ username: currentUser, content: input.value }]);
            input.value = '';
        }

        function appendMsg(m) {
            const box = document.getElementById('chatBox');
            const isMe = m.username === currentUser;
            const div = document.createElement('div');
            div.className = `flex flex-col ${isMe ? 'items-end' : 'items-start'} mb-2`;
            div.innerHTML = `<span class="text-[10px] text-gray-400 mb-1 px-1">${m.username}</span><div class="${isMe ? 'bg-emerald-500 text-white shadow-md' : 'bg-white text-gray-800 shadow-sm'} p-3 rounded-2xl text-sm max-w-[85%]">${m.content}</div>`;
            box.appendChild(div);
            box.scrollTop = box.scrollHeight;
        }

        function logout() { localStorage.removeItem("sb_user"); location.reload(); }
    </script>
</body>
</html>
